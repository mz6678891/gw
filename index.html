<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公文格式转换工具</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
        }

        /* 上半部分：输入区 */
        .input-section {
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            resize: vertical;
            box-sizing: border-box;
            font-family: inherit;
        }

        .controls {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap; 
        }

        button {
            padding: 10px 25px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: background 0.3s, transform 0.1s;
        }

        button:active {
            transform: scale(0.98);
        }

        /* 新增：清除格式按钮样式 (橙色系) */
        #clearBtn {
            background-color: #fd7e14;
            color: white;
        }
        #clearBtn:hover {
            background-color: #e36d0d;
        }

        #convertBtn {
            background-color: #007BFF;
            color: white;
        }
        #convertBtn:hover {
            background-color: #0056b3;
        }

        #downloadBtn {
            background-color: #28a745;
            color: white;
            display: none; 
        }
        #downloadBtn:hover {
            background-color: #218838;
        }

        #statusMsg {
            color: #666;
            font-size: 14px;
            font-weight: bold;
            display: none;
        }

        /* 提示框样式 */
        .tip-box {
            display: none; 
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.6;
        }

        .tip-box strong {
            display: block;
            margin-bottom: 5px;
        }

        .tip-box ol {
            margin: 0;
            padding-left: 20px;
        }

        .tip-box li {
            margin-bottom: 5px;
        }

        /* 下半部分：预览区 */
        .preview-section {
            margin-top: 30px;
            border-top: 2px dashed #eee;
            padding-top: 20px;
        }

        .preview-label {
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            color: #555;
        }

        #outputPreview {
            border: 1px solid #ccc;
            padding: 40px; 
            background: white;
            min-height: 400px;
            overflow-y: auto;
        }

        /* * 核心样式定义：用于预览和导出 
         * 首行缩进 1.15cm
         */
        
        .doc-title {
            font-family: '方正小标宋_GBK', 'SimSun', serif;
            font-size: 22pt;
            font-weight: normal;
            text-align: center;
            line-height: 28.8pt;
            text-indent: 0;
            margin: 0 0 28.8pt 0;
        }

        .doc-h2 {
            font-family: 'SimHei', '黑体', sans-serif;
            font-size: 16pt;
            font-weight: normal;
            text-indent: 1.15cm;
            line-height: 28.8pt;
            margin: 0;
        }

        .doc-p {
            font-family: '方正仿宋_GB2312', 'FangSong_GB2312', 'FangSong', serif;
            font-size: 16pt;
            font-weight: normal;
            text-indent: 1.15cm;
            line-height: 28.8pt;
            margin: 0;
            text-align: justify;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>公文格式排版工具</h1>
    
    <div class="input-section">
        <textarea id="inputText" placeholder="在此粘贴纯文本内容。&#10;第一行将被识别为大标题。&#10;以“一、”、“二、”开头的行将被识别为二级标题。"></textarea>
        <div class="controls">
            <button id="clearBtn" onclick="clearMarkdown()">清除Markdown格式</button>
            <button id="convertBtn" onclick="processText()">开始转换</button>
            <span id="statusMsg">✅ 已转换完成</span>
            <button id="downloadBtn" onclick="exportToWord()">下载doc文件</button>
        </div>
        
        <div id="tipBox" class="tip-box">
            <strong>请注意：</strong>
            <ol>
                <li>打开doc文档默认Web版式（小地球图标），请点击WPS/Word右下角切换为页面视图（页面图标），然后保存文档即可。</li>
                <li>doc文档的标题字体是“方正小标宋_GBK”，正文是“方正仿宋_GB2312”，如发现字体不对，请自行下载安装这两款字体。</li>
            </ol>
        </div>
    </div>

    <div class="preview-section">
        <span class="preview-label">实际效果预览：</span>
        <div id="outputPreview"></div>
    </div>
</div>

<script>
    // 工具函数：智能处理连字符
    // 删除所有"-"，除非它处于两个数字之间（如 8:00-9:00）
    function smartRemoveHyphens(text) {
        // 1. 先将“数字-数字”这种模式中的横杠替换为一个特殊的占位符
        let protectedText = text.replace(/(\d)-(\d)/g, '$1§§HYPHEN§§$2');
        // 2. 删除剩余所有的横杠
        protectedText = protectedText.replace(/-/g, '');
        // 3. 将占位符还原回横杠
        return protectedText.replace(/§§HYPHEN§§/g, '-');
    }

    // 新功能：清除Markdown格式
    function clearMarkdown() {
        let text = document.getElementById('inputText').value;
        if (!text) return;

        // 1. 删除 *, #, | 符号
        text = text.replace(/[\*#|]/g, '');

        // 2. 智能删除连字符 (保留 8:00-9:00)
        text = smartRemoveHyphens(text);

        // 3. 处理每一行：删除首行空格，删除空行
        let lines = text.split('\n');
        let cleanedLines = [];

        lines.forEach(line => {
            // 删除开头的所有空白字符
            let trimmedLine = line.replace(/^\s+/, ''); 
            // 如果这一行不是空的，就保留
            if (trimmedLine !== '') {
                cleanedLines.push(trimmedLine);
            }
        });

        // 4. 将处理后的文本放回输入框
        document.getElementById('inputText').value = cleanedLines.join('\n');
    }

    function processText() {
        let rawText = document.getElementById('inputText').value;
        if (!rawText.trim()) {
            alert("请输入需要转换的文本！");
            return;
        }

        // 1. 这里也使用智能去除连字符逻辑，防止用户没点“清除格式”直接点“开始转换”时误删时间段横杠
        let cleanText = smartRemoveHyphens(rawText);

        // 2. 按行分割
        let lines = cleanText.split('\n');
        let htmlContent = '';

        // 3. 逐行处理逻辑
        const level2Regex = /^[一二三四五六七八九十]+、/;

        lines.forEach((line, index) => {
            let trimLine = line.trim();
            if (trimLine === '') return; 

            if (index === 0) {
                // 大标题
                htmlContent += `<div class="doc-title">${trimLine}</div>`;
            } 
            else if (level2Regex.test(trimLine)) {
                // 二级标题
                htmlContent += `<div class="doc-h2">${trimLine}</div>`;
            } 
            else {
                // 正文
                htmlContent += `<div class="doc-p">${trimLine}</div>`;
            }
        });

        // 渲染到预览框
        document.getElementById('outputPreview').innerHTML = htmlContent;

        // UI 交互更新
        document.getElementById('statusMsg').style.display = 'inline';
        document.getElementById('downloadBtn').style.display = 'inline-block';
        document.getElementById('tipBox').style.display = 'block'; 
    }

    function exportToWord() {
        const content = document.getElementById('outputPreview').innerHTML;
        
        const header = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                  xmlns:w='urn:schemas-microsoft-com:office:word' 
                  xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset='utf-8'>
                <title>Export HTML to Word Document with CSS</title>
                <style>
                    @page {
                        mso-page-orientation: portrait;
                        size: 21cm 29.7cm; /* A4 */
                        margin: 2.54cm 3.17cm;
                    }
                    body {
                        font-family: "方正仿宋_GB2312", "FangSong", serif;
                    }
                    .doc-title {
                        font-family: '方正小标宋_GBK', serif;
                        font-size: 22pt;
                        font-weight: normal;
                        text-align: center;
                        line-height: 28.8pt;
                        text-indent: 0;
                        margin-bottom: 28.8pt;
                        mso-style-name: "Title";
                    }
                    .doc-h2 {
                        font-family: 'SimHei', '黑体', sans-serif;
                        font-size: 16pt;
                        font-weight: normal;
                        text-indent: 1.15cm;
                        line-height: 28.8pt;
                        margin: 0;
                        mso-style-name: "Heading 2";
                    }
                    .doc-p {
                        font-family: '方正仿宋_GB2312', 'FangSong_GB2312', serif;
                        font-size: 16pt;
                        font-weight: normal;
                        text-indent: 1.15cm;
                        line-height: 28.8pt;
                        margin: 0;
                        text-align: justify;
                        text-justify: inter-ideograph;
                    }
                </style>
            </head>
            <body>
        `;
        
        const footer = "</body></html>";
        const sourceHTML = header + content + footer;

        const blob = new Blob(['\ufeff', sourceHTML], {
            type: 'application/msword'
        });

        const downloadLink = document.createElement("a");
        document.body.appendChild(downloadLink);

        if (navigator.msSaveOrOpenBlob) {
            navigator.msSaveOrOpenBlob(blob, '公文格式文档.doc');
        } else {
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.download = '公文格式文档.doc';
            downloadLink.click();
            setTimeout(function() {
                window.URL.revokeObjectURL(url);
                document.body.removeChild(downloadLink);
            }, 0);
        }
    }
</script>

</body>
</html>
